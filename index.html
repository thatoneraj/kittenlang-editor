<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üêæ KittenLang & Python Editor + Terminal</title>
  <style>
    /* Girly pastel theme */
    :root {
      --bg: #fff0f6;
      --bg-dark: #f7d6e0;
      --text: #572a4e;
      --text-light: #a75893;
      --accent: #d66ba0;
      --accent-light: #f9cee6;
      --border: #f0a6ca;
      --error: #e75480;
      --font: 'Comic Sans MS', cursive, sans-serif;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0; font-family: var(--font);
      display: flex; flex-direction: column;
      height: 100vh;
      background: var(--bg);
      color: var(--text);
      overflow: hidden;
    }
    h1 {
      text-align: center;
      padding: 1rem 0 0 0;
      font-weight: 900;
      font-size: 2.2rem;
      letter-spacing: 0.1em;
      color: var(--accent);
      user-select: none;
      flex-shrink: 0;
    }
    #container {
      flex: 1;
      display: flex;
      flex-direction: row;
      gap: 1rem;
      padding: 1rem;
      min-height: 0;
      overflow: hidden;
    }
    textarea {
      flex: 1;
      padding: 1rem;
      border: 2px solid var(--border);
      border-radius: 10px;
      background: var(--bg-dark);
      color: var(--text);
      font-family: monospace, monospace;
      font-size: 14px;
      line-height: 1.4;
      resize: none;
      overflow-y: auto;
      min-height: 300px;
      transition: border-color 0.3s ease;
      min-width: 0;
    }
    textarea:focus {
      outline: none;
      border-color: var(--accent);
      background: #ffe6f0;
    }
    label {
      display: block;
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: var(--accent);
    }
    .panel {
      display: flex;
      flex-direction: column;
      flex: 1;
      min-width: 0;
    }
    #translate-info {
      font-size: 0.9rem;
      color: var(--text-light);
      margin-bottom: 0.5rem;
      user-select: none;
      font-style: italic;
      text-align: center;
    }
    #controls {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin: 1rem 0 0 0;
      flex-wrap: wrap;
      flex-shrink: 0;
      padding: 0 1rem;
    }
    button {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 15px;
      background: var(--accent);
      color: white;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 3px 6px rgba(214,107,160,0.5);
      transition: background-color 0.3s ease;
      user-select: none;
      flex-shrink: 0;
      min-width: 80px;
      text-align: center;
    }
    button:hover, button:focus {
      background: var(--error);
      outline: none;
    }
    #terminal {
      margin: 1rem 1rem 1rem 1rem;
      background: var(--bg-dark);
      border-radius: 10px;
      border: 2px solid var(--border);
      height: 200px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      font-family: monospace;
      color: var(--text);
      flex-shrink: 0;
    }
    #terminal-output {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
      white-space: pre-wrap;
      background: #ffd9e8;
      border-bottom: 2px solid var(--border);
      user-select: text;
    }
    #terminal-input-container {
      display: flex;
      border-top: 2px solid var(--border);
      background: #fce9f2;
      padding: 0.5rem 1rem;
    }
    #terminal-input {
      flex: 1;
      border: none;
      background: transparent;
      font-family: monospace;
      font-size: 16px;
      color: var(--accent);
      padding: 0.25rem 0.5rem;
    }
    #terminal-input:focus {
      outline: none;
    }
    #extraControls {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      width: 100%;
      justify-content: center;
    }
    #toggleExtraControls {
      padding: 0.3rem 0.6rem;
      font-size: 0.85rem;
      border-radius: 12px;
      min-width: auto;
      background: var(--accent-light);
      color: var(--accent);
      font-weight: 700;
      cursor: pointer;
      box-shadow: none;
      border: 2px solid var(--accent);
      user-select: none;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    #toggleExtraControls:hover, #toggleExtraControls:focus {
      background: var(--accent);
      color: white;
      outline: none;
    }

    /* Responsive - stack panels vertically on narrow screens */
    @media (max-width: 700px) {
      #container {
        flex-direction: column;
        padding: 1rem 0.5rem;
        gap: 0.75rem;
      }
      .panel {
        min-height: 200px;
      }
      textarea {
        min-height: 180px;
        font-size: 13px;
      }
      #terminal {
        height: 180px;
        margin: 0.5rem 0 1rem 0;
      }
      #controls {
        padding: 0 0.5rem;
      }
      button {
        font-size: 0.9rem;
        padding: 0.45rem 0.9rem;
        min-width: 70px;
      }
      #extraControls {
        justify-content: center;
      }
    }

    /* On desktop, show extra controls inline and hide toggle */
    @media (min-width: 601px) {
      #toggleExtraControls {
        display: none;
      }
      #extraControls {
        display: flex !important;
        margin-top: 0;
        width: auto;
      }
    }

  </style>
</head>
<body>
  <h1>üêæ KittenLang & Python Editor + Terminal</h1>
  <div id="container">
    <section class="panel" aria-label="Python or KittenLang input">
      <label for="leftInput">Left (Python or KittenLang)</label>
      <textarea id="leftInput" spellcheck="false" autocomplete="off" autocorrect="off" autocapitalize="off"
        aria-describedby="leftDesc" placeholder="Write Python or KittenLang code here..."></textarea>
      <div id="leftDesc" style="font-size: 0.8rem; margin-top: 0.2rem; color: var(--text-light); user-select:none;">
        Write code here. Left ‚Üî Right auto-translates.
      </div>
    </section>

    <section class="panel" aria-label="KittenLang or Python output">
      <label for="rightOutput">Right (KittenLang or Python)</label>
      <textarea id="rightOutput" spellcheck="false" readonly aria-readonly="true"
        aria-describedby="rightDesc" placeholder="Translated code appears here..." ></textarea>
      <div id="rightDesc" style="font-size: 0.8rem; margin-top: 0.2rem; color: var(--text-light); user-select:none;">
        Translated code. Edits here also translate back left.
      </div>
    </section>
  </div>

  <div id="controls">
    <button id="runBtn" aria-label="Run Python code">Run üê±</button>
  
    <button id="toggleExtraControls" aria-expanded="false" aria-controls="extraControls" >
      Show Controls ‚ñº
    </button>
  
    <div id="extraControls" style="display:none; gap:1rem; margin-top: 0.5rem;">
      <button id="clearLeft" aria-label="Clear left input">Clear Left</button>
      <button id="clearRight" aria-label="Clear right output">Clear Right</button>
      <button id="clearTerminal" aria-label="Clear terminal output">Clear Terminal</button>
    </div>
  </div>

  <div id="terminal" role="region" aria-live="polite" aria-atomic="false" aria-label="Terminal output">
    <div id="terminal-output"></div>
    <div id="terminal-input-container">
      <input id="terminal-input" aria-label="Terminal input line" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" disabled />
    </div>
  </div>

  <!-- Pyodide -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
  <script>
    // === KittenLang dictionary ===
    const pythonToKitten = {
      def: "lick",
      class: "clawss",
      return: "bring",
      yield: "drop",
      pass: "napass",
      break: "pawbreak",
      continue: "pawtinue",
      if: "nya",
      elif: "nyan",
      else: "meow",
      for: "paw",
      while: "mrr",
      try: "purr",
      except: "hiss",
      finally: "stretch",
      with: "snuggle",
      as: "fluff",
      import: "fetch",
      from: "scruff",
      global: "catwide",
      nonlocal: "nocatwide",
      lambda: "kitbda",
      del: "scratchout",
      assert: "pawfirm",
      raise: "hissup",
      async: "prowl",
      await: "waitpaw",
      match: "clawmatch",
      case: "pawsome",
      and: "pawand",
      or: "pawor",
      not: "nopaw",
      in: "whiskin",
      is: "isfur",
      True: "yarn",
      False: "nap",
      None: "nada",
      print: "cattype",
      input: "catnap",
      len: "tail",
      open: "scratch",
      range: "leap",
      list: "litter",
      dict: "basket",
      set: "purrset",
      int: "whiskint",
      float: "milkfloat",
      str: "furstr",
      bool: "meowbool",
      type: "pawtype",
      zip: "buddyup",
      map: "changeall",
      filter: "pickpaw",
      any: "someone",
      all: "everyone",
      sum: "totaltreats",
      min: "smallestpaw",
      max: "biggestpaw",
      abs: "jump",
      sorted: "orderup",
      round: "roundbowl",
      enumerate: "rollcall",
    };

    const kittenToPython = Object.fromEntries(
      Object.entries(pythonToKitten).map(([k, v]) => [v, k])
    );

    // Operator mappings
    const operatorPythonToKitten = [
      [/\!=/g, "!:33"],
      [/==/g, ":33"],
      [/>=/g, ">:33"],
      [/<=/g, "<:33"],
      [/>>=/g, ">>:3"],
      [/<<=/g, "<<:3"],
      [/\*\*=/g, "**:3"],
      [/\+=/g, "+:3"],
      [/-=/g, "-:3"],
      [/\*=/g, "*:3"],
      [/\/=/g, "/:3"],
      [/\/\/=/g, "//:3"],
      [/%=/g, "%:3"],
      [/&=/g, "&:3"],
      [/\|=/g, "|:3"],
      [/\^=/g, "^:3"],
      [/=/g, ":3"],
    ];

    const operatorKittenToPython = [
      [/\!:33/g, "!="],
      [/:33/g, "=="],
      [/>:33/g, ">="],
      [/<:33/g, "<="],
      [/>>:3/g, ">>="],
      [/<<:3/g, "<<="],
      [/\*\*:3/g, "**="],
      [/\+:3/g, "+="],
      [/-:3/g, "-="],
      [/\*:3/g, "*="],
      [/\/:3/g, "/="],
      [/\/\/:3/g, "//="],
      [/%:3/g, "%="],
      [/&:3/g, "&="],
      [/\|:3/g, "|="],
      [/\^:3/g, "^="],
      [/:3/g, "="],
    ];

    // Escape regex helper
    function escapeRegex(s) {
      return s.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
    }

    // Translate Python ‚Üí KittenLang
    function pythonToKittenTranslate(code) {
      operatorPythonToKitten.forEach(([pattern, replacement]) => {
        code = code.replace(pattern, replacement);
      });

      Object.keys(pythonToKitten)
        .sort((a, b) => b.length - a.length)
        .forEach(k => {
          const regex = new RegExp("\\b" + escapeRegex(k) + "\\b", "g");
          code = code.replace(regex, pythonToKitten[k]);
        });
      return code;
    }

    // Translate KittenLang ‚Üí Python
    function kittenToPythonTranslate(code) {
      operatorKittenToPython.forEach(([pattern, replacement]) => {
        code = code.replace(pattern, replacement);
      });

      Object.keys(kittenToPython)
        .sort((a, b) => b.length - a.length)
        .forEach(k => {
          const regex = new RegExp("\\b" + escapeRegex(k) + "\\b", "g");
          code = code.replace(regex, kittenToPython[k]);
        });
      return code;
    }

    // Elements
    const leftInput = document.getElementById("leftInput");
    const rightOutput = document.getElementById("rightOutput");
    const runBtn = document.getElementById("runBtn");
    const clearLeft = document.getElementById("clearLeft");
    const clearRight = document.getElementById("clearRight");
    const clearTerminal = document.getElementById("clearTerminal");
    const terminalOutput = document.getElementById("terminal-output");
    const terminalInput = document.getElementById("terminal-input");

    // Prevent circular events on editing
    let isUpdatingLeft = false;
    let isUpdatingRight = false;

    // Update right when left changes (auto detect Python or KittenLang)
    leftInput.addEventListener("input", () => {
      if (isUpdatingLeft) return;
      isUpdatingRight = true;

      const code = leftInput.value.trim();
      // Heuristic: if code contains kitten keywords replace right with Python else KittenLang
      const hasKittenWords = Object.keys(kittenToPython).some(w => code.includes(w));
      if (hasKittenWords) {
        rightOutput.value = kittenToPythonTranslate(code);
      } else {
        rightOutput.value = pythonToKittenTranslate(code);
      }

      isUpdatingRight = false;
    });

    // Update left when right changes
    rightOutput.addEventListener("input", () => {
      if (isUpdatingRight) return;
      isUpdatingLeft = true;

      const code = rightOutput.value.trim();
      const hasPythonWords = Object.keys(pythonToKitten).some(w => code.includes(w));
      if (hasPythonWords) {
        leftInput.value = pythonToKittenTranslate(code);
      } else {
        leftInput.value = kittenToPythonTranslate(code);
      }

      isUpdatingLeft = false;
    });

    // --- Pyodide setup and interactive terminal ---

    let pyodideReady = false;
    let pyodide = null;

    // Input queue for Python input()
    let inputResolver = null;

    // Append text to terminal with optional error styling
    function appendToTerminal(text, isError = false) {
      const span = document.createElement("span");
      span.textContent = text;
      if (isError) span.style.color = "var(--error)";
      terminalOutput.appendChild(span);
      terminalOutput.appendChild(document.createElement("br"));
      terminalOutput.scrollTop = terminalOutput.scrollHeight;
    }

    // Initialize pyodide
    async function initPyodide() {
      appendToTerminal("üêæ Loading Python runtime...");
      pyodide = await loadPyodide();

      // Override input to await input from terminal input line
      await pyodide.runPythonAsync(`
import builtins
import asyncio

async def input_override(prompt=None):
    from js import enableInputLine
    enableInputLine()
    if prompt:
        print(prompt, end="", flush=True)
    from js import getInputFromUser
    user_input = await getInputFromUser()
    return user_input

builtins.input = input_override
      `);

      pyodideReady = true;
      appendToTerminal("üêæ Python runtime loaded. Ready to run code.");
    }
    initPyodide();

    // JS helper to enable input line and wait for user input
    window.enableInputLine = function () {
      terminalInput.disabled = false;
      terminalInput.focus();
    };
    window.getInputFromUser = function () {
      return new Promise((resolve) => {
        inputResolver = resolve;
      });
    };

    terminalInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !terminalInput.disabled) {
        e.preventDefault();
        const val = terminalInput.value;
        terminalInput.value = "";
        terminalInput.disabled = true;
        appendToTerminal(val);
        if (inputResolver) {
          inputResolver(val);
          inputResolver = null;
        }
      }
    });

    // Run code button
    runBtn.addEventListener("click", async () => {
      if (!pyodideReady) {
        appendToTerminal("üêæ Python runtime not ready yet. Please wait...");
        return;
      }

      terminalOutput.textContent = "";
      terminalInput.value = "";
      terminalInput.disabled = true;

      let codeLeft = leftInput.value.trim();
      let codeRight = rightOutput.value.trim();

      // Determine which side to run:
      // If left has code, run left (translated if needed)
      // else run right (translated if needed)
      let codeToRun = "";
      const isLeftKitten = Object.keys(kittenToPython).some(w => codeLeft.includes(w));
      const isRightKitten = Object.keys(kittenToPython).some(w => codeRight.includes(w));

      if (codeLeft.length > 0) {
        if (isLeftKitten) {
          codeToRun = kittenToPythonTranslate(codeLeft);
          rightOutput.value = codeToRun;
        } else {
          codeToRun = codeLeft;
          rightOutput.value = pythonToKittenTranslate(codeLeft);
        }
      } else if (codeRight.length > 0) {
        if (isRightKitten) {
          codeToRun = kittenToPythonTranslate(codeRight);
          leftInput.value = codeToRun;
        } else {
          codeToRun = codeRight;
          leftInput.value = pythonToKittenTranslate(codeRight);
        }
      } else {
        appendToTerminal("üêæ No code to run!");
        return;
      }

      try {
        pyodide.setStdout({
          batched: (s) => appendToTerminal(s),
        });
        pyodide.setStderr({
          batched: (s) => appendToTerminal(s, true),
        });

        await pyodide.runPythonAsync(codeToRun);
        appendToTerminal("üêæ Program finished.");
      } catch (err) {
        appendToTerminal("üêæ Error: " + err.message, true);
      } finally {
        terminalInput.disabled = true;
        inputResolver = null;
      }
    });

    // Clear buttons
    clearLeft.addEventListener("click", () => {
      leftInput.value = "";
      rightOutput.value = "";
    });
    clearRight.addEventListener("click", () => {
      rightOutput.value = "";
      leftInput.value = "";
    });
    clearTerminal.addEventListener("click", () => {
      terminalOutput.textContent = "";
    });

    // Toggle extra controls button
    const toggleExtraControls = document.getElementById("toggleExtraControls");
    const extraControls = document.getElementById("extraControls");
    toggleExtraControls.addEventListener("click", () => {
      const expanded = toggleExtraControls.getAttribute("aria-expanded") === "true";
      if (expanded) {
        extraControls.style.display = "none";
        toggleExtraControls.textContent = "Show Controls ‚ñº";
        toggleExtraControls.setAttribute("aria-expanded", "false");
      } else {
        extraControls.style.display = "flex";
        toggleExtraControls.textContent = "Hide Controls ‚ñ≤";
        toggleExtraControls.setAttribute("aria-expanded", "true");
      }
    });
  </script>
</body>
</html>
